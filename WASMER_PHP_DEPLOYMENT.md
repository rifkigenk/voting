# ğŸš€ Deploy PHP Application to Wasmer Edge

Complete guide for deploying the MPS Voting Application (full PHP stack) to Wasmer Edge.

## ğŸ¯ What You'll Deploy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Wasmer Edge                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  PHP 8.2 + Apache           â”‚   â”‚
â”‚   â”‚  (All files: HTML, PHP, JS) â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  MySQL 8.4 (Addon)          â”‚   â”‚
â”‚   â”‚  Automatic backup & scaling â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Your app: https://mps-voting.rifkigenk.wasmer.app
```

## âœ… Prerequisites

- [x] Wasmer CLI installed
- [x] Docker installed (for local testing)
- [x] GitHub account (optional, for CI/CD)
- [x] `wasmer.toml` configured âœ… (already done)
- [x] `Dockerfile` created âœ… (already done)

## ğŸ“‹ Deployment Methods

### **Option 1: Deploy via Wasmer Web UI (Easiest)**

#### Step 1: Go to Wasmer.sh Web Console
- URL: https://app.wasmer.io
- Login with your account

#### Step 2: Configure Project
```
Project Preset: PHP
Runtime: Docker
Build Command: docker build -t mps-voting-php .
Start Command: /usr/local/bin/apache2-foreground
Port: 8080
```

#### Step 3: Select Environment Type
```
Environment Template: PHP with MySQL
MySQL Version: 8.4
```

#### Step 4: Add Environment Variables
```
DATABASE_HOST = mysql.internal
DATABASE_USER = mps_voting
DATABASE_NAME = mps_voting
DATABASE_PORT = 3306
ENVIRONMENT = production
TIMEZONE = Asia/Jakarta
```

#### Step 5: Deploy
Click **"Deploy"** and wait 5-10 minutes

---

### **Option 2: Deploy via CLI (Faster)**

```powershell
# Step 1: Login to Wasmer
wasmer login

# Step 2: Navigate to project
cd "d:\XAMPP\htdocs\Projek MPS\mps-voting"

# Step 3: Create app.yaml (automatic configuration)
wasmer app create \
  --name mps-voting \
  --owner rifkigenk \
  --template php \
  --include-database mysql

# Step 4: Deploy
wasmer deploy

# Step 5: Get your URL
wasmer list
wasmer describe --name mps-voting
```

Your app: `https://mps-voting.rifkigenk.wasmer.app`

---

### **Option 3: Deploy via Docker (Hybrid)**

#### Local Testing First
```powershell
# Build and test locally
docker-compose up -d

# Access at:
# App: http://localhost
# PhpMyAdmin: http://localhost:8080
```

#### Then Deploy to Wasmer
```powershell
# Build Docker image
docker build -t rifkigenk/mps-voting-php .

# Push to registry (optional)
docker push rifkigenk/mps-voting-php

# Deploy to Wasmer
wasmer app create \
  --name mps-voting \
  --from-dockerfile ./Dockerfile
```

---

### **Option 4: Deploy via GitHub (Auto-Deploy)**

#### Step 1: Push to GitHub
```bash
git init
git add .
git commit -m "Initial MPS Voting Application"
git remote add origin https://github.com/rifkigenk/voting.git
git push -u origin main
```

#### Step 2: Connect to Wasmer
1. Go to https://app.wasmer.io/deployments
2. Click "Connect GitHub"
3. Select repository
4. Choose branch: `main`
5. Configure build settings
6. Click "Deploy"

Every push auto-deploys! âœ¨

---

## ğŸ”§ Configuration Files

### wasmer.toml
```toml
[app]
name = "mps-voting"

[image]
dockerfile = "./Dockerfile"

[env]
DATABASE_HOST = "mysql.internal"
DATABASE_USER = "mps_voting"
DATABASE_NAME = "mps_voting"

[services.mysql]
type = "mysql"
version = "8.4"
```

### Dockerfile
```dockerfile
FROM php:8.2-apache

RUN docker-php-ext-install mysqli pdo pdo_mysql
RUN a2enmod rewrite

WORKDIR /var/www/html
COPY . /var/www/html/

EXPOSE 8080
CMD ["apache2-foreground"]
```

---

## ğŸ“ Environment Variables to Set

After deployment, configure these in Wasmer dashboard:

```
DATABASE_HOST=mysql.internal          # Auto-set by Wasmer
DATABASE_USER=mps_voting              # Auto-set by Wasmer
DATABASE_PASSWORD=<auto-generated>    # Auto-set by Wasmer
DATABASE_NAME=mps_voting
DATABASE_PORT=3306
ENVIRONMENT=production
TIMEZONE=Asia/Jakarta
PHP_MEMORY_LIMIT=256M
MAX_EXECUTION_TIME=30
```

---

## âœ… Verify Deployment

### Check Frontend
```bash
# Open browser
https://mps-voting.rifkigenk.wasmer.app
```

You should see the voting homepage!

### Test Backend Endpoints
```bash
# Test results page
curl https://mps-voting.rifkigenk.wasmer.app/php/results.php

# Test API
curl https://mps-voting.rifkigenk.wasmer.app/php/admin_login.php \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

### View Logs
```bash
wasmer logs --name mps-voting --follow
```

---

## ğŸ—„ï¸ Database Setup

### Automatic (Recommended)
```
Wasmer handles:
âœ… MySQL 8.4 provisioning
âœ… Database creation (mps_voting)
âœ… User setup (mps_voting)
âœ… Automatic backups
âœ… Scaling
```

### Manual Database Operations

#### Connect to MySQL
```bash
# Get connection details
wasmer database describe --name mps-voting

# Connect from terminal
mysql -h <HOST> -u mps_voting -p mps_voting < backup.sql
```

#### Backup
```bash
# Create backup
mysqldump -h <HOST> -u mps_voting -p mps_voting > backup_$(date +%Y%m%d).sql

# Upload to Wasmer
wasmer backup create --name mps-voting
```

#### Restore
```bash
mysql -h <HOST> -u mps_voting -p mps_voting < backup.sql
```

---

## ğŸš¨ Troubleshooting

### Deployment Fails
```powershell
# Check logs
wasmer logs --name mps-voting --follow

# Verbose deploy
wasmer deploy --verbose

# Rebuild
wasmer deploy --force
```

### PHP Errors
```bash
# View Apache error logs
wasmer logs --name mps-voting | grep -i error

# SSH into container (if available)
wasmer shell mps-voting
tail -f /var/log/apache2/error.log
```

### Database Connection Failed
```bash
# Test connection
mysql -h mysql.internal -u mps_voting -p mps_voting -e "SELECT 1"

# Check environment variables
wasmer env list --name mps-voting
```

### Application Crashes
```bash
# Check health
wasmer health --name mps-voting

# Restart
wasmer restart --name mps-voting

# View recent logs
wasmer logs --name mps-voting --tail 100
```

---

## ğŸ“Š Monitoring & Maintenance

### Real-time Logs
```bash
wasmer logs --name mps-voting --follow
```

### Performance Metrics
```bash
wasmer stats --name mps-voting
```

### Health Check
```bash
curl https://mps-voting.rifkigenk.wasmer.app/health
```

### Database Backups
```bash
# Automatic (enabled by default)
# View backups
wasmer backup list --name mps-voting

# Create manual backup
wasmer backup create --name mps-voting --description "Pre-election backup"
```

---

## ğŸ” Security Best Practices

- [ ] Change default admin password (`admin123` â†’ strong password)
- [ ] Enable HTTPS (automatic âœ…)
- [ ] Set database password via secrets
- [ ] Enable rate limiting
- [ ] Configure firewall rules (if available)
- [ ] Regular backups enabled
- [ ] Monitor error logs
- [ ] Keep PHP updated

---

## ğŸ¯ Post-Deployment Checklist

- [ ] App is live and accessible
- [ ] Homepage loads without errors
- [ ] PHP endpoints responding
- [ ] Database connected
- [ ] Login flows work
- [ ] Voter voting works end-to-end
- [ ] Face recognition works (if enabled)
- [ ] Results display correctly
- [ ] Backups are configured
- [ ] Monitoring/alerts configured

---

## ğŸ“ Support & Resources

- **Wasmer Docs**: https://docs.wasmer.io
- **Wasmer Community**: https://discord.gg/ZwZUJmS
- **PHP Docker Hub**: https://hub.docker.com/_/php
- **MySQL Docs**: https://dev.mysql.com/doc

---

## ğŸ‰ You're Live!

Your MPS Voting Application is now running on Wasmer Edge!

- **URL**: https://mps-voting.rifkigenk.wasmer.app
- **Database**: Managed MySQL 8.4
- **Backups**: Automatic
- **SSL/TLS**: Automatic
- **Scaling**: Automatic

**Next Steps**:
1. Change default admin password
2. Add real voters and candidates
3. Monitor election day traffic
4. Analyze voting results
