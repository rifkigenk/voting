# Wasmer App Configuration - Native PHP (No Docker Required)
# Deploys PHP directly to Wasmer Edge runtime

[app]
name = "mps-voting"
version = "1.0.0"
description = "MPS Elections 2026 - PHP Voting Application"

# Using Wasmer's built-in PHP runtime
[runtime]
name = "php"
version = "8.2"

# Entry point
entrypoint = "index.php"

# Environment variables
[env]
ENVIRONMENT="production"
TIMEZONE="Asia/Jakarta"
PHP_DISPLAY_ERRORS="0"
PHP_LOG_ERRORS="1"

# Database configuration
[env]
DATABASE_HOST="mysql.internal"
DATABASE_USER="mps_voting"
DATABASE_NAME="mps_voting"
DATABASE_PORT="3306"

# MySQL addon configuration
[services.mysql]
type="mysql"
version="8.4"
automatically_provision = true

# Connect MySQL service to app
[[databases]]
name="mysql"
service="mysql"
env_prefix="DATABASE"

# Health check
[[healthchecks]]
path="/"
initial_delay=5
interval=30
timeout=10

# CORS headers
[cors]
allow_origins=["*"]
allow_methods=["GET","POST","PUT","DELETE","OPTIONS"]
allow_headers=["Content-Type","Accept","Authorization"]
allow_credentials=true
max_age=3600

# Caching strategy
[cache]
# No cache for HTML
[[cache.routes]]
path="/*.html"
max_age=0

# Short cache for PHP
[[cache.routes]]
path="/php/**"
max_age=60

# Long cache for static
[[cache.routes]]
path="/style/**"
max_age=86400

[[cache.routes]]
path="/assets/**"
max_age=86400


